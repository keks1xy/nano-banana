<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Nano Banana</title>
</head>
<body>

  <h1>Nano Banana üçå</h1>

  <form method="post">
    <input name="prompt" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç" style="width:300px">
    <button type="submit">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
  </form>

  {% if status %}
  <p>
    <b>–°—Ç–∞—Ç—É—Å:</b>
    <span id="status">
      {% if status == "queued" %}
        –≤ –æ—á–µ—Ä–µ–¥–∏ ‚è≥
      {% elif status == "processing" %}
        –≤ –æ–±—Ä–∞–±–æ—Ç–∫–µ ‚öôÔ∏è
      {% elif status == "done" %}
        –≥–æ—Ç–æ–≤–æ ‚úÖ
      {% endif %}
    </span>
  </p>
  {% endif %}

  <!-- –ë–õ–û–ö –î–õ–Ø –ö–ê–†–¢–ò–ù–û–ö -->
  <div
    id="images"
    style="
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 16px;
      margin-top: 20px;
      max-width: 700px;
    "
  ></div>

  {% if job_id %}
  <script>
    const jobId = "{{ job_id }}";

    async function checkStatus() {
      const res = await fetch(`/status/${jobId}`);
      const data = await res.json();

      const statusEl = document.getElementById("status");
      const imagesEl = document.getElementById("images");

      if (!statusEl) return;

      if (data.status === "queued") {
        statusEl.innerText = "–≤ –æ—á–µ—Ä–µ–¥–∏ ‚è≥";
      }
      else if (data.status === "processing") {
        statusEl.innerText = "–≤ –æ–±—Ä–∞–±–æ—Ç–∫–µ ‚öôÔ∏è";
      }
      else if (data.status === "done") {
        statusEl.innerText = "–≥–æ—Ç–æ–≤–æ ‚úÖ";

        if (data.images && imagesEl.innerHTML === "") {
          data.images.forEach(url => {
            const img = document.createElement("img");
            img.src = url;
            img.style.width = "100%";
            img.style.borderRadius = "12px";
            imagesEl.appendChild(img);
          });
        }

        return; // –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ–ø—Ä–æ—Å
      }

      setTimeout(checkStatus, 1000);
    }

    checkStatus();
  </script>
  {% endif %}

</body>
</html>
