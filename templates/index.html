<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Nano Banana</title>

  <style>
    .gallery {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 16px;
      margin-top: 20px;
      max-width: 800px;
    }

    .image-card {
      position: relative;
    }

    .image-card img {
      width: 100%;
      border-radius: 12px;
      cursor: pointer;
      display: block;
    }

    .image-card a.download {
      position: absolute;
      right: 10px;
      bottom: 10px;
      background: rgba(0,0,0,0.7);
      color: white;
      text-decoration: none;
      padding: 6px 10px;
      border-radius: 8px;
      font-size: 14px;
    }

    /* –ú–æ–¥–∞–ª–∫–∞ */
    .modal {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.85);
      align-items: center;
      justify-content: center;
      z-index: 999;
    }

    .modal img {
      max-width: 90%;
      max-height: 90%;
      border-radius: 12px;
    }

    .modal.show {
      display: flex;
    }
  </style>
</head>

<body>

  <h1>Nano Banana üçå</h1>

  <form method="post">
    <input name="prompt" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç" style="width:300px">
    <button type="submit">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
  </form>

  {% if status %}
  <p>
    <b>–°—Ç–∞—Ç—É—Å:</b>
    <span id="status">
      {% if status == "queued" %}
        –≤ –æ—á–µ—Ä–µ–¥–∏ ‚è≥
      {% elif status == "processing" %}
        –≤ –æ–±—Ä–∞–±–æ—Ç–∫–µ ‚öôÔ∏è
      {% elif status == "done" %}
        –≥–æ—Ç–æ–≤–æ ‚úÖ
      {% endif %}
    </span>
  </p>
  {% endif %}

  <div id="images" class="gallery"></div>

  <!-- –ú–û–î–ê–õ–ö–ê -->
  <div id="modal" class="modal" onclick="closeModal()">
    <img id="modal-img">
  </div>

  {% if job_id %}
  <script>
    const jobId = "{{ job_id }}";

    async function checkStatus() {
      const res = await fetch(`/status/${jobId}`);
      const data = await res.json();

      const statusEl = document.getElementById("status");
      const imagesEl = document.getElementById("images");

      if (!statusEl) return;

      if (data.status === "queued") {
        statusEl.innerText = "–≤ –æ—á–µ—Ä–µ–¥–∏ ‚è≥";
      }
      else if (data.status === "processing") {
        statusEl.innerText = "–≤ –æ–±—Ä–∞–±–æ—Ç–∫–µ ‚öôÔ∏è";
      }
      else if (data.status === "done") {
        statusEl.innerText = "–≥–æ—Ç–æ–≤–æ ‚úÖ";

        if (data.images && imagesEl.innerHTML === "") {
          data.images.forEach((url, i) => {
            const card = document.createElement("div");
            card.className = "image-card";

            const img = document.createElement("img");
            img.src = url;
            img.onclick = () => openModal(url);

            const download = document.createElement("a");
            download.href = url;
            download.download = `nano-banana-${i+1}.jpg`;
            download.innerText = "‚¨á –°–∫–∞—á–∞—Ç—å";
            download.className = "download";

            card.appendChild(img);
            card.appendChild(download);
            imagesEl.appendChild(card);
          });
        }
        return;
      }

      setTimeout(checkStatus, 1000);
    }

    function openModal(url) {
      const modal = document.getElementById("modal");
      const img = document.getElementById("modal-img");
      img.src = url;
      modal.classList.add("show");
    }

    function closeModal() {
      document.getElementById("modal").classList.remove("show");
    }

    checkStatus();
  </script>
  {% endif %}

</body>
</html>
